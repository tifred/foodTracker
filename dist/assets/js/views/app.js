var app=app||{};app.AppView=Backbone.View.extend({el:$("main"),events:{"keypress #searchbar":"addSearchResult","click #showMoreResults":"addMoreSearchResults","click #saveDay":"addSavedDay"},initialize:function(){self=this,this.$searchbar=$("#searchbar"),this.searchresultslist=$("#searchresultslist"),this.foodtable=$("#foodtable"),this.showMoreResults=$("#showMoreResults"),this.lastSearchInput="",this.lastSearchRangeStart=0,this.saveDay=$("#saveDay"),this.savedDayRow=$(".saved-days-row"),this.savedDaysCount=0,this.listenTo(app.foods,"add",this.render),this.listenTo(app.foods,"remove",this.render),this.listenTo(app.foods,"reset",this.render),this.showMoreResults.hide(),this.saveDay.hide()},render:function(){console.log("rendered"),self.$("#foodtable .table-data-food").remove(),self.$("#foodtable #table-total-row").remove(),app.searchresults.reset(),self.$("#searchresultslist li").remove(),this.showMoreResults.hide(),console.log(app.foods.length),app.foods.length>0?(console.log("in if"),this.saveDay.show()):this.saveDay.hide(),this.lastSearchInput="",this.lastSearchRangeStart=0;var e=0;app.foods.each(function(a){e+=a.get("calories");var s=new app.FoodView({model:a});self.foodtable.append(s.render().el)}),self.foodtable.append('<tr id="table-total-row"><th>Total</th><th id="total">'+e+"</th></tr>")},addSearchResult:function(e){if(e.which===ENTER_KEY&&this.$searchbar.val().trim()){app.searchresults.reset(),self.$("#searchresultslist li").remove();var a=this.$searchbar.val().trim();self.lastSearchInput=a;var s="https://api.nutritionix.com/v1_1/search/"+a+"?results=0:3&fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat&appId=c6f2c498&appKey=63a855793383d6e263e27c9993661a29";$.getJSON(s).done(function(e){for(var a=0;a<e.hits.length;a++)app.searchresults.create({name:e.hits[a].fields.item_name,calories:Math.floor(e.hits[a].fields.nf_calories)});app.searchresults.each(function(e){var a=new app.SearchResultView({model:e});self.searchresultslist.append(a.render().el)}),self.showMoreResults.show()}).fail(function(){self.searchresultslist.append("<div>Search Failed.</div>")}),this.$searchbar.val("")}},addMoreSearchResults:function(){var e=self.lastSearchRangeStart+3,a=e+3,s=""+e+":"+a;self.$("#searchresultslist li").remove();var t="https://api.nutritionix.com/v1_1/search/"+self.lastSearchInput+"?results="+s+"&fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat&appId=c6f2c498&appKey=63a855793383d6e263e27c9993661a29";$.getJSON(t).done(function(e){for(var a=0;a<e.hits.length;a++)app.searchresults.create({name:e.hits[a].fields.item_name,calories:Math.floor(e.hits[a].fields.nf_calories)});app.searchresults.each(function(e){var a=new app.SearchResultView({model:e});self.searchresultslist.append(a.render().el)}),self.showMoreResults.show(),self.lastSearchRangeStart+=3}).fail(function(){self.searchresultslist.append("<div>Search Failed.</div>")})},addSavedDay:function(){self.savedDaysCount++,app.foodsSavedDay=app.foods.clone();var e=0;self.savedDaysCount%4===1&&self.savedDaysCount>1&&(self.savedDayRow.after('<section class="row saved-days-row"></section>'),self.savedDayRow=$(".saved-days-row:last")),self.savedDayRow.append('<div class="col-xs-12 col-sm-6 col-md-3"><div>Day '+self.savedDaysCount+'</div><table class="table table-striped table-bordered table-condensed table-hover table-day'+self.savedDaysCount+'"><tbody><tr><th>Food</th><th>Calories</th></tr>'),app.foodsSavedDay.each(function(a){e+=a.get("calories");var s=new app.FoodSavedDayView({model:a});$(".table-day"+self.savedDaysCount+" tbody").append(s.render().el)}),$(".table-day"+self.savedDaysCount+" tbody").append('<tr id="table-total-row"><th>Total</th><th id="total">'+e+"</th></tr>"),self.savedDayRow.append("</tbody></table></div>"),app.foodsSavedDay.reset(),app.foods.reset()}});