var app=app||{};app.AppView=Backbone.View.extend({el:$("main"),events:{"keypress #searchbar":"createSearchResults","click #showMoreResults":"createMoreSearchResults","click #saveDay":"createSavedDay","click #clearFoods":"foodsDestroy"},initialize:function(){this.$searchbar=$("#searchbar"),this.$searchresultslist=$("#searchresultslist"),this.$recentresultslist=$("#recentresultslist"),this.$foodtable=$("#foodtable"),this.showMoreResults=$("#showMoreResults"),this.loadingResults=$("#loadingResults"),this.$saveDay=$("#saveDay"),this.$savedDayRow=$(".saved-days-row"),this.savedDaysCount=0,this.$clearFoods=$("#clearFoods"),this.rangeStart=0,this.rangeEnd=3,this.lastSearchInput="",this.searchInput="",this.useLastSearchInput=!1,this.listenTo(app.searchresults,"add",this.addSearchResults),this.listenTo(app.foods,"add",this.addFood),this.listenTo(app.foods,"add",this.clearSearchResults),this.listenTo(app.recentresults,"add",this.addRecent),this.listenTo(app.foods,"remove",this.RemoveAndAddAllFoods),this.listenTo(app.foods,"update",this.render),this.listenTo(app.foods,"saveTheDay",this.addSavedDays),this.showMoreResults.hide(),this.loadingResults.hide(),this.$saveDay.hide(),this.$clearFoods.hide(),app.recentresults.fetch(),app.foods.fetch()},render:function(){var e=this;app.foods.length>0?(this.$saveDay.show(),this.$clearFoods.show(),this.addTotalCals()):(this.$saveDay.hide(),this.$clearFoods.hide(),e.$("#foodtable #table-total-row").remove())},addTotalCals:function(){var e=this,a=0;app.foods.each(function(e){a+=e.get("calories")}),e.$("#foodtable #table-total-row").remove(),e.$foodtable.append('<tr id="table-total-row"><th>Total</th><th id="total">'+a+"</th></tr>")},createSearchResults:function(e){var a=this;if(a.useLastSearchInput)searchInput=a.lastSearchInput;else{if(e.which!==ENTER_KEY||!this.$searchbar.val().trim())return;this.loadingResults.show(),searchInput=this.$searchbar.val().trim(),a.lastSearchInput=searchInput,a.rangeStart=0,a.rangeEnd=3,app.searchresults.reset()}var t=""+a.rangeStart+":"+a.rangeEnd,s="https://api.nutritionix.com/v1_1/search/"+searchInput+"?results="+t+"&fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat&appId=c6f2c498&appKey=63a855793383d6e263e27c9993661a29";$.getJSON(s).done(function(e){0===e.hits.length&&app.searchresults.create({name:"No Matching Foods Were Found",calories:0,brandName:" "});for(var a=0;a<e.hits.length;a++)app.searchresults.create({name:e.hits[a].fields.item_name,calories:Math.floor(e.hits[a].fields.nf_calories),brandName:e.hits[a].fields.brand_name})}).fail(function(){app.searchresults.create({name:"Could Not Reach Server With Food Information",calories:0,brandName:" "})}),this.$searchbar.val(""),a.useLastSearchInput=!1},addSearchResults:function(){var e=this;e.$("#searchresultslist li").remove(),app.searchresults.each(function(a){var t=new app.SearchResultView({model:a});e.$searchresultslist.append(t.render().el)}),e.showMoreResults.show(),e.loadingResults.hide()},createMoreSearchResults:function(){var e=this;e.rangeStart+=3,e.rangeEnd+=3,e.useLastSearchInput=!0,this.createSearchResults()},clearSearchResults:function(){var e=this;app.searchresults.reset(),e.$("#searchresultslist li").remove(),e.lastSearchInput="",e.rangeStart=0,e.rangeEnd=3,this.useLastSearchInput=!1,e.showMoreResults.hide()},addRecent:function(e){var a=this,t=new app.RecentResultView({model:e});a.$recentresultslist.append(t.render().el)},addFood:function(e){var a=this,t=new app.FoodView({model:e});a.$foodtable.append(t.render().el)},RemoveAndAddAllFoods:function(){var e=this;e.$("#foodtable .table-data-food").remove(),app.foods.each(this.addFood,this)},createSavedDay:function(){app.allSavedDays=app.allSavedDays||[],app.allSavedDays.push(app.foods.clone()),app.foods.trigger("saveTheDay")},addSavedDays:function(){var e=this;e.$savedDayRow.find("div").remove();for(var a=0;a<app.allSavedDays.length;a++){var t=a+1,s=0;e.$savedDayRow.append('<div class="col-xs-12 col-sm-6 col-md-3"><div>Day '+t+'</div><table class="table table-striped table-bordered table-condensed table-hover table-day'+t+'"><tbody><tr><th>Food</th><th>Calories</th></tr>'),app.allSavedDays[a].each(function(e){s+=e.get("calories");var a=new app.FoodSavedDayView({model:e});$(".table-day"+t+" tbody").append(a.render().el)}),$(".table-day"+t+" tbody").append('<tr id="table-total-row"><th>Total</th><th id="total">'+s+"</th></tr>"),e.$savedDayRow.append("</tbody></table></div>")}},foodsDestroy:function(){for(;app.foods.models.length>0;)app.foods.at(0).destroy()}});