var app=app||{};app.AppView=Backbone.View.extend({el:$("main"),events:{"keypress #searchbar":"createSearchResults","click #showMoreResults":"createMoreSearchResults","click #saveDay":"createSavedDay","click #clearFoods":"foodsDestroy"},initialize:function(){self=this,this.$searchbar=$("#searchbar"),this.$searchresultslist=$("#searchresultslist"),this.$recentresultslist=$("#recentresultslist"),this.$foodtable=$("#foodtable"),this.showMoreResults=$("#showMoreResults"),this.loadingResults=$("#loadingResults"),this.$saveDay=$("#saveDay"),this.$savedDayRow=$(".saved-days-row"),this.savedDaysCount=0,this.$clearFoods=$("#clearFoods"),this.rangeStart=0,this.rangeEnd=3,this.lastSearchInput="",this.searchInput="",this.useLastSearchInput=!1,this.listenTo(app.searchresults,"add",this.addSearchResults),this.listenTo(app.foods,"add",this.addFood),this.listenTo(app.foods,"add",this.clearSearchResults),this.listenTo(app.recentresults,"add",this.addRecent),this.listenTo(app.foods,"remove",this.RemoveAndAddAllFoods),this.listenTo(app.foods,"update",this.render),this.listenTo(app.foods,"saveTheDay",this.addSavedDays),this.showMoreResults.hide(),this.loadingResults.hide(),this.$saveDay.hide(),this.$clearFoods.hide(),app.recentresults.fetch(),app.foods.fetch()},render:function(){app.foods.length>0?(this.$saveDay.show(),this.$clearFoods.show(),this.addTotalCals()):(this.$saveDay.hide(),this.$clearFoods.hide(),self.$("#foodtable #table-total-row").remove())},addTotalCals:function(){var e=0;app.foods.each(function(s){e+=s.get("calories")}),self.$("#foodtable #table-total-row").remove(),self.$foodtable.append('<tr id="table-total-row"><th>Total</th><th id="total">'+e+"</th></tr>")},createSearchResults:function(e){if(self.useLastSearchInput)searchInput=self.lastSearchInput;else{if(e.which!==ENTER_KEY||!this.$searchbar.val().trim())return;this.loadingResults.show(),searchInput=this.$searchbar.val().trim(),self.lastSearchInput=searchInput,self.rangeStart=0,self.rangeEnd=3,app.searchresults.reset()}var s=""+self.rangeStart+":"+self.rangeEnd,a="https://api.nutritionix.com/v1_1/search/"+searchInput+"?results="+s+"&fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat&appId=c6f2c498&appKey=63a855793383d6e263e27c9993661a29";$.getJSON(a).done(function(e){0===e.hits.length&&app.searchresults.create({name:"No Matching Foods Were Found",calories:0});for(var s=0;s<e.hits.length;s++)app.searchresults.create({name:e.hits[s].fields.item_name,calories:Math.floor(e.hits[s].fields.nf_calories)})}).fail(function(){app.searchresults.create({name:"Could Not Reach Server With Food Information",calories:0})}),this.$searchbar.val(""),self.useLastSearchInput=!1},addSearchResults:function(){self.$("#searchresultslist li").remove(),app.searchresults.each(function(e){var s=new app.SearchResultView({model:e});self.$searchresultslist.append(s.render().el)}),self.showMoreResults.show(),self.loadingResults.hide()},createMoreSearchResults:function(){self.rangeStart+=3,self.rangeEnd+=3,self.useLastSearchInput=!0,this.createSearchResults()},clearSearchResults:function(){app.searchresults.reset(),self.$("#searchresultslist li").remove(),self.lastSearchInput="",self.rangeStart=0,self.rangeEnd=3,this.useLastSearchInput=!1,self.showMoreResults.hide()},addRecent:function(e){var s=new app.RecentResultView({model:e});self.$recentresultslist.append(s.render().el)},addFood:function(e){var s=new app.FoodView({model:e});self.$foodtable.append(s.render().el)},RemoveAndAddAllFoods:function(){self.$("#foodtable .table-data-food").remove(),app.foods.each(this.addFood,this)},createSavedDay:function(){app.allSavedDays=app.allSavedDays||[],app.allSavedDays.push(app.foods.clone()),app.foods.trigger("saveTheDay")},addSavedDays:function(){self.$savedDayRow.find("div").remove();for(var e=0;e<app.allSavedDays.length;e++){var s=e+1,a=0;self.$savedDayRow.append('<div class="col-xs-12 col-sm-6 col-md-3"><div>Day '+s+'</div><table class="table table-striped table-bordered table-condensed table-hover table-day'+s+'"><tbody><tr><th>Food</th><th>Calories</th></tr>'),app.allSavedDays[e].each(function(e){a+=e.get("calories");var t=new app.FoodSavedDayView({model:e});$(".table-day"+s+" tbody").append(t.render().el)}),$(".table-day"+s+" tbody").append('<tr id="table-total-row"><th>Total</th><th id="total">'+a+"</th></tr>"),self.$savedDayRow.append("</tbody></table></div>")}},foodsDestroy:function(){for(;app.foods.models.length>0;)app.foods.at(0).destroy()}});